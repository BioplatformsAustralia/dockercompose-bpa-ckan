# data only container pattern
datadev:
  image: muccg/debian8-base
  volumes:
    - ./data/dev:/data

cache:
  image: memcached:1.4

nginx:
  image: muccg/nginx-uwsgi:1.9
  ports:
    - "8443:443"
    - "8080:80"
  volumes:
    - ./data/nginx:/data
  links:
      - ckan:uwsgi

datastore:
  image: mdillon/postgis:9.5
  ports:
    - 5432
  environment:
    - POSTGRES_USER=datastore
    - POSTGRES_PASSWORD=datastore

db:
  image: mdillon/postgis:9.5
  ports:
    - 5432
  environment:
    - POSTGRES_USER=ckan
    - POSTGRES_PASSWORD=ckan

solr:
  image: solr:5.5
  ports:
      - "8983:8983"
  volumes:
      - ./solr/ckan:/opt/solr/server/solr/ckan

datapusher:
  image: muccg/bpa-datapusher:latest

ckan:
  image: muccg/bpa-ckan:latest
  environment:
    - DBUSER=ckan
    - WAIT_FOR_DB=1
    - WAIT_FOR_DATASTORE=1
    - WAIT_FOR_SOLR=1
    - WAIT_FOR_CACHE=1
    - SESSION_SECRET=${SESSION_SECRET}
    - AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY}
    - AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}
    - AWS_BUCKET_NAME=${AWS_BUCKET_NAME}
    - AWS_STORAGE_PATH=composeenv
  ports:
    - 9100
    - 9101
  links:
    - db
    - datastore
    - solr
    - cache
#    - datapusher
